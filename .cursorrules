# Cursor Rules for auto-tensaku-system

## 必須参照ファイル

**重要**: このプロジェクトでは、作業を開始する前に必ず以下のファイルを参照してください：

1. **`web/AGENT.md`** - プロジェクトの基本方針、デプロイ関連の問題と解消法、トラブルシューティングガイド
   - このファイルには、プロジェクトの構造、デプロイ時の注意事項、よくある問題とその解決方法が記載されています
   - デプロイ関連の問題が発生した場合は、まずこのファイルを確認してください

## プロジェクト構造

- **メインアプリケーション**: `web/` ディレクトリ内のNext.jsアプリケーション
- **プロジェクトルート**: リポジトリのルートディレクトリ
- **設定ファイル**: `web/` ディレクトリ内に配置

## 作業時の注意事項

1. **既存のTypeScript/Next.js構成を尊重**: 破壊的変更を避けること
2. **日本語での返答**: すべての返答は日本語で行うこと
3. **AGENT.mdの参照**: 問題が発生した場合は、まず`web/AGENT.md`を確認すること
4. **デプロイ前の確認**: デプロイ前に`web/AGENT.md`のチェックリストを確認すること

## ファイル編集時の注意

- `web/src/lib/prompts/eduShift.ts` - システムインストラクション（重要なOCRルール、採点基準を含む）
- `web/src/lib/core/grader.ts` - 採点ロジック（OCR誤読検出、常体・敬体チェックなど）
- `web/src/app/api/grade/route.ts` - APIルート（PDF変換、ファイル処理）

これらのファイルを編集する際は、既存の仕様を尊重し、破壊的変更を避けてください。

## AIアシスタントの行動規則

### Web検索の必須活用（カットオフ日対策）

**重要**: AIの学習データにはカットオフ日があり、最新のAPI/モデル/ライブラリ情報を持っていない可能性があります。以下のケースでは**必ずWeb検索（web_search）で最新情報を確認**してください：

1. **外部API/モデル名が出てきた場合**
   - 例: Gemini API、OpenAI API、その他のAI/クラウドサービス
   - モデル名（gemini-xxx、gpt-xxx等）は頻繁に変更される

2. **ユーザーの設定値が「存在しない」と思われる場合**
   - 断定せず、まずWeb検索で確認する
   - 「このモデルは存在しません」と言う前に必ず検索

3. **APIエラーの原因が不明な場合**
   - エラーメッセージに含まれるモデル名/エンドポイントを検索
   - 最新の仕様変更がないか確認

4. **ライブラリのバージョンや互換性問題**
   - 新しいバージョンでの変更点を検索
   - 非推奨になった機能がないか確認

### 禁止事項

- カットオフ日以降にリリースされた可能性のあるAPI/モデルについて、**検索せずに「存在しない」と断定すること**
- ユーザーが提示した公式ドキュメントの情報より、自身の古い知識を優先すること


